<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
	<title>Document</title>
	<style type="text/css">
		@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
		*{padding: 0; margin: 0; box-sizing: border-box; border: 0;}
		#lienzo{width: 731px; height: 411px; border: 1px solid dimgray; background-image: url('img/fondo2.png'); position: relative;}
		#vidrio{width: 100%; height: 100%; background: limegreen; position: absolute; top: 0; left: 0; opacity: 0.3; display: none;}
		.circulo{width: 100px; height: 100px; background-image: url('img/circulo.svg'); background-size: 100% 100%; display: flex; justify-content: center; align-items: center; font-size: 30px; cursor: pointer; font-family: "Poppins"; position: absolute; user-select: none; display: none;}
		#btnplay{width: 60px; height: 60px; background-image: url('img/btnplay.png'); background-size: 100% 100%; position: absolute; left: 0; right: 0; margin: auto; bottom: 20px; border: 2px solid black; border-radius: 50%; cursor: pointer;}
		.pulso{animation: pulse; animation-duration: 1s; animation-iteration-count: infinite;}
		.entradaArriba{animation: backInDown; animation-duration: 1s;  animation-fill-mode: forwards;}
		.bouncein{animation: bounceIn; animation-duration: 1s;}
		.txtsilaba{user-select: none;}
	</style>
</head>
<body>

	<audio id="myAudio" src="audio/silabama.mp3" preload="metadata"></audio>

	<div id="lienzo">
		<div id="vidrio"></div>
		<div class="circulo" style="left: 58px;top: 178px;"></div>
		<div class="circulo" style="left: 183px;top: 82px;"></div>
		<div class="circulo" style="left: 311px; top: 178px;"></div>
		<div class="circulo" style="left: 442px;top: 82px;"></div>
		<div class="circulo" style="left: 570px;top: 178px;"></div>
		<div id="btnplay"></div>
	</div>

	<script type="text/javascript">
		
		const silabas=['ma','me','mi','mo','mu'];
		// Crea un elemento de audio y carga el archivo de audio
		const audio = new Audio('audio/silabama.mp3');
		let silabaDictada="";

		window.onload=function(){

			desordenarArray(silabas);

			colocarSilabas();

			animarSilabas();

			const segment1=document.querySelector("#btnplay");
			segment1.classList.add('pulso');
			segment1.addEventListener('click',()=>{
				document.querySelector("#btnplay").classList.remove('pulso');
				reproducir(silabas[0]);
			});
		}

		// Llamamos a la función cuando se carga la página y cuando se cambia el tamaño de la ventana
		window.addEventListener("load", escalarYCentrar);
		window.addEventListener("resize", escalarYCentrar);

		function desordenarArray(array) {
		  array.sort(() => Math.random() - 0.5);
		}

		// Define la función que reproducirá una parte del audio
		function reproducirParte(segInicio, segFinal) {
		  audio.currentTime = segInicio;
		  audio.play();
		  setTimeout(function() {
		    audio.pause();
		    audio.currentTime = segInicio;
		  }, (segFinal - segInicio) * 1000);
		}

		function reproducir(silaba){
			switch(silaba){
				case 'ma':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(1.2, 2.6); 
						silabaDictada="ma";
					}, 1400);
				break;
				case 'me':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(2.6, 3.4); 
						silabaDictada="me";
					}, 1400);
				break;
				case 'mi':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(3.4, 4.3); 
						silabaDictada="mi";
					}, 1400);
				break;
				case 'mo':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(4.3, 5.1); 
						silabaDictada="mo";
					}, 1400);
				break;
				case 'mu':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(5.1, 5.9); 
						silabaDictada="mu";
					}, 1400);
				break;
				case 'bien':
					setTimeout(function() {reproducirParte(5.9, 7);}, 1400);
				break;
				case 'denuevo':
					setTimeout(function() {reproducirParte(7, 9);}, 1400);
				break;
			}
		}

		function colocarSilabas(){
			const circulos=document.querySelectorAll(".circulo");
			circulos.forEach(function(item,index){
				item.addEventListener('click',function(){
					//console.log(event.target.textContent);
					console.log(event);
					event.stopPropagation();
					this.classList.add('bouncein');
					if(silabaDictada!==""){
						if(silabaDictada===this.textContent){
							console.log("listt");
						}
					}
				});
				let span=`<span class='txtsilaba'>${silabas[index]}</span>`
				item.insertAdjacentHTML('beforeend',span);
			});
		}

		function animarSilabas(){
			let circulos=document.querySelectorAll(".circulo");
			circulos.forEach(function(item){
				let tiempo=Math.random();
				item.style.animationDelay=tiempo+'s';
				item.classList.add('entradaArriba');
				setTimeout(function(){item.style.display="flex";},10);
			});
		}

		function escalarYCentrar() {
		  // Obtenemos el div que queremos escalar y centrar
		  let div = document.getElementById("lienzo");

		  // Le aplicamos los estilos necesarios
		  div.setAttribute('style','position:absolute; left:0%; top:0%; transform:translate(-50%, -50%); transform-origin: 0% 0%;');
		  
		  // Obtenemos las dimensiones de la ventana del navegador
		  let anchoVentana = window.innerWidth;
		  let altoVentana = window.innerHeight;
		  
		  // Calculamos el factor de escala en base al ancho y alto del div
		  let factorAncho = anchoVentana / 731;
		  let factorAlto = altoVentana / 411;
		  let factorEscala = Math.min(factorAncho, factorAlto);
		  
		  // Escalamos el div
		  div.style.transform = "scale(" + factorEscala + ")";
		  
		  // Centramos el div en la ventana
		  let anchoEscalado = 731 * factorEscala;
		  let altoEscalado = 411 * factorEscala;
		  let margenHorizontal = (anchoVentana - anchoEscalado) / 2;
		  let margenVertical = (altoVentana - altoEscalado) / 2;
		  div.style.marginLeft = margenHorizontal + "px";
		  div.style.marginTop = margenVertical + "px";
		}
	</script>
</body>
</html>