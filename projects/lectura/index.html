<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
	<title>Document</title>
	<style type="text/css">
		@import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
		*{padding: 0; margin: 0; box-sizing: border-box; border: 0;}
		#lienzo{width: 731px; height: 411px; border: 1px solid dimgray; background-image: url('img/fondo2.png'); position: relative; user-select: none; display: flex; justify-content: center; align-items: center;}
		#cont_silabas{border-bottom: 1px solid gray; width: 100%; height: 250px; display: flex; justify-content: center; align-items: flex-start; padding-top: 40px;}
		.silaba{width: 100px; aspect-ratio: 1/1; border: 1px solid gray; margin-right: 20px; border-radius: 5px; display: flex; justify-content: center; align-items: center; background-color: white; cursor: pointer; display: none;}
		.silaba span{font-size: 30px; font-family: Poppins;}
		#btnplay{width: 60px; height: 60px; background-image: url('img/btnplay.png'); background-size: 100% 100%; position: absolute; left: 0; right: 0; margin: auto; bottom: 50px; border: 2px solid black; border-radius: 50%; cursor: pointer;}
		#btnrecargar{width: 40px; height: 40px; background-image: url('img/btnrecargar.png'); background-size: 100% 100%; cursor: pointer; margin: 0 auto;}
		.entradaArriba{animation: backInDown; animation-duration: 1s;  animation-fill-mode: forwards;}
		.pulso{animation: pulse; animation-duration: 1s; animation-iteration-count: infinite;}
		.page{width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none;}
		#vidrio{width: 100%; height: 100%; background-color: limegreen; position: absolute; top: 0; left: 0; opacity: 1;}
		.page .titulo{font-size: 30px; font-family: Poppins; margin-bottom: 30px; padding: 20px; border-bottom: 1px solid dimgray; text-align: center; padding-top: 25px; font-weight: bold;}
		.page .subt{margin-bottom: 20px; font-weight: bold; font-size: 25px; font-family: Poppins; padding-top: 20px; text-align: center;}
		#aciertos{font-size: 50px; font-family: Poppins; text-align: center;}
		#cont2{width: 50%; padding: 10px;}
		.page #contimg{width: 50%; display: flex; justify-content: center; align-items: center;}
		.page img{width: 300px;}
	</style>
</head>
<body>
	<div id="lienzo">
		<div id="cont_silabas">
			<div class="silaba" paint="false"><span></span></div>
			<div class="silaba" paint="false"><span></span></div>
			<div class="silaba" paint="false"><span></span></div>
			<div class="silaba" paint="false"><span></span></div>
			<div class="silaba" paint="false"><span></span></div>
		</div>
		<div id="btnplay"></div>
		<div class="page">
			<div id="contimg">
				<img src="img/medalla.png" alt="iconomedalla">
			</div>
			<div id="cont2">
				<p class="titulo">ACTIVIDAD FINALIZADA</p>
				<p id="aciertos">80%</p>
				<p class="subt">Desempe√±o</p>
				<div id="btnrecargar"></div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		const silabas=['ma','me','mi','mo','mu'];
		// Crea un elemento de audio y carga el archivo de audio
		const audio = new Audio('audio/silabama.mp3');
		let silabaDictada="";
		let aciertos=0;
		let fallos=0;
	</script>

	<script type="text/javascript">
		function desordenarArray(array) {
			////
		  array.sort(() => Math.random() - 0.5);
		}
		function colocarSilabas(){
			let span_silabas=document.querySelectorAll(".silaba span");
			span_silabas.forEach(function(item,index){
				item.textContent=silabas[index];
				setTimeout(function(){
					item.parentNode.classList.add('entradaArriba');
					item.parentNode.style.display="flex";
				},100);
			});
		}
		function reproducirParte(segInicio, segFinal) {
		  audio.currentTime = segInicio;
		  audio.play();
		  setTimeout(function() {
		    audio.pause();
		    audio.currentTime = segInicio;
		  }, (segFinal - segInicio) * 1000);
		}
		function reproducir(silaba){
			switch(silaba){
				case 'ma':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(1.2, 2.6); 
						silabaDictada="ma";
					}, 1400);
				break;
				case 'me':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(2.6, 3.4); 
						silabaDictada="me";
					}, 1400);
				break;
				case 'mi':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(3.4, 4.2); 
						silabaDictada="mi";
					}, 1400);
				break;
				case 'mo':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(4.3, 5.1); 
						silabaDictada="mo";
					}, 1400);
				break;
				case 'mu':
					reproducirParte(0, 1.2);
					setTimeout(function() {
						reproducirParte(5.1, 5.9); 
						silabaDictada="mu";
					}, 1400);
				break;
				case 'bien':
					setTimeout(function() {reproducirParte(5.9, 7);}, 400);
				break;
				case 'denuevo':
					setTimeout(function() {reproducirParte(7, 9);}, 400);
				break;
			}
		}
		function agregarEventosBoton(){
			const segment1=document.querySelector("#btnplay");
			segment1.classList.add('pulso');
			segment1.addEventListener('click',()=>{
				document.querySelector("#btnplay").classList.remove('pulso');
				reproducir(silabas[0]);
			});
		}
		function agregarEventosSilabas(){
			let obj_silabas=document.querySelectorAll(".silaba");
			obj_silabas.forEach(function(item){
				item.addEventListener('click',function(){
					let paint=this.getAttribute("paint");
					if(paint==="false"){
						let txt=this.textContent;
						if(silabaDictada!==""){
							if(silabaDictada===txt){
								pintar('bien',this);
								reproducir("bien");
								silabas.shift();
								//setTimeout(function(){reproducir(silabas[0]);},2100);
								aciertos++;
								if(aciertos===5){
									finalizarActividad();
								}
							}else{
								pintar('mal',this);
								reproducir("denuevo");
								fallos++;
							}
						}
					}
				});
			});
		}
		function pintar(texto,elemento){
			let paint=elemento.getAttribute("paint");
			if(texto==="bien"){
				elemento.style.backgroundColor="limegreen";
				elemento.setAttribute("paint","true");
			}else{
				elemento.style.backgroundColor="indianred";
				//elemento.setAttribute("paint","true");
			}
		}
		function agregarEvnetosBotonRecargar(){
			let recargar=document.querySelector("#btnrecargar");
			recargar.addEventListener("click",function(){window.location.reload();});
		}
		function finalizarActividad(){
			setTimeout(function(){
				document.querySelector("#aciertos").textContent=((aciertos-fallos)*100)/5+'%';
				document.querySelector("#btnplay").style.display="none";
				document.querySelector("#cont_silabas").style.display="none";
				document.querySelector(".page").style.display="flex";
			},1000);
		}
		function escalarYCentrar() {
		  // Obtenemos el div que queremos escalar y centrar
		  let div = document.getElementById("lienzo");

		  // Le aplicamos los estilos necesarios
		  div.setAttribute('style','position:absolute; left:0%; top:0%; transform:translate(-50%, -50%); transform-origin: 0% 0%;');
		  
		  // Obtenemos las dimensiones de la ventana del navegador
		  let anchoVentana = window.innerWidth;
		  let altoVentana = window.innerHeight;
		  
		  // Calculamos el factor de escala en base al ancho y alto del div
		  let factorAncho = anchoVentana / 731;
		  let factorAlto = altoVentana / 411;
		  let factorEscala = Math.min(factorAncho, factorAlto);
		  
		  // Escalamos el div
		  div.style.transform = "scale(" + factorEscala + ")";
		  
		  // Centramos el div en la ventana
		  let anchoEscalado = 731 * factorEscala;
		  let altoEscalado = 411 * factorEscala;
		  let margenHorizontal = (anchoVentana - anchoEscalado) / 2;
		  let margenVertical = (altoVentana - altoEscalado) / 2;
		  div.style.marginLeft = margenHorizontal + "px";
		  div.style.marginTop = margenVertical + "px";
		}
	</script>

	<script type="text/javascript">
		window.onload=function(){
			desordenarArray(silabas);
			colocarSilabas();
			desordenarArray(silabas);
			agregarEventosBoton();
			agregarEventosSilabas();
			agregarEvnetosBotonRecargar();
		}
		window.addEventListener("load", escalarYCentrar);
		window.addEventListener("resize", escalarYCentrar);
	</script>
</body>
</html>