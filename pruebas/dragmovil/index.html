<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style type="text/css">
		*{padding: 0; border: 0; margin: 0; box-sizing: border-box;}
		#lienzo{
			border: 1px solid black;
			width: 100%;
			aspect-ratio: 731/411;
			position: relative;
		}
		#cuadro{
			position: absolute;
			left: 0px; top: 0px;
			height: 50%;
			aspect-ratio: 90/90;
			background: lightgreen;
		}
		#cuadro2{
			position: absolute;
			left: 0px; top: 50%;
			height: 50%;
			aspect-ratio: 90/90;
			background: orangered;
		}
	</style>
</head>
<body>
	<div id="lienzo">
		<div id="cuadro2" class="drag movil"></div>
		<div id="cuadro" class="drag" base="cuadro2"></div>
	</div>

	<script type="text/javascript">
		let lienzo=document.querySelector("#lienzo");

		window.onload=function(){
			let btn = document.createElement("button");
			  btn.textContent = 'Fulscreen!';
			  btn.addEventListener('click', btnClicked);
			  document.body.append(btn);
			window.onresize();
		}
		window.onresize=function(){
			adaptarLienzo();
		}

		function btnClicked(){
		  document
		    .getElementById("lienzo")
		    .requestFullscreen();
		}

		function adaptarLienzo(){
			let wpantalla=window.innerWidth;
			let hpantalla=window.innerHeight;
			let wlienzo=lienzo.offsetWidth;
			let hlienzo=lienzo.offsetHeight;
			//console.log(wpantalla,wlienzo,hpantalla,hlienzo);
			if(hpantalla<hlienzo){
				//console.log("El ancho de pantalla es menor");
				lienzo.style.width="auto";
				lienzo.style.height=hpantalla+"px";
			}
		}


		function drag(selector,detectarBase,funcion1,funcion2,distancia=5,volverPuntoInicio=false){
			let elementPress="";
			let pinitleft=0; let pintitop=0;
			let dispositivo="";
			document.addEventListener('mousemove',onMouseMove);
			document.addEventListener("mousedown",iniciodrag);
			document.addEventListener("mouseup",onMouseEnd);
			document.addEventListener('touchmove',onMouseMove);
			document.addEventListener("touchstart",iniciodrag);
			document.addEventListener("touchend",onMouseEnd);
			//Se elimino un condicional que determinaba si era pc o movil y de acuerdo a eso
			//se agregaban los listener correspondientes.

			function iniciodrag(event){
				let eventox=event.clientX || event.touches[0].clientX;
				let eventoy=event.clientY || event.touches[0].clientY;
				let elementos=buscarObjetoEn(lienzo,eventox,eventoy);
				elementPress=filtrarElemento(selector,elementos);
				if(elementPress!==undefined){
					elementPress.setAttribute("initposx",elementPress.offsetLeft);
					elementPress.setAttribute("initposy",elementPress.offsetTop);
					pinitleft=(eventox-elementPress.getBoundingClientRect().left);
					pintitop=(eventoy-elementPress.getBoundingClientRect().top);  
				}
			}
			function onMouseMove(event){
				let pageX=event.pageX || event.touches[0].pageX;
				let pageY=event.pageY || event.touches[0].pageY;
				if(elementPress!==undefined && elementPress!==""){
					let dx=((pageX - pinitleft)*100)/lienzo.offsetWidth+"%";
					let dy=((pageY -  pintitop)*100)/lienzo.offsetHeight+"%";
					elementPress.style.left = dx;
					elementPress.style.top = dy;
				}
			}
			function buscarObjetoEn(divpadre,x,y){
				let elementos=divpadre.children;
				let divsenpos=[];
				
				for(let i=elementos.length-1;i>=0;i--){
					//console.log(elementos[i]);
					let item=elementos[i];
					let limIzq=item.offsetLeft;
					let limDer=(item.offsetLeft+item.offsetWidth);
					let limArr=item.offsetTop;
					let limAba=(item.offsetTop+item.offsetHeight);
					//console.log(x,y);
					//console.log(limIzq,limDer,limArr,limAba);
					if(x>=limIzq && x<=limDer && y>=limArr && y<=limAba){
						divsenpos.push(item);
					}
				}

				return(divsenpos);		
			}
			function filtrarElemento(selector,array){
				let signo=selector.charAt(0);
				switch(signo){
					case "#":
						//console.log("selector de id");
						for(let i=0;i<array.length;i++){
							let item=array[i];
							let name="#"+item.getAttribute("id");
							//console.log(name);
							if(name===selector){
								//console.log("encontraod");
								//console.log(item);
								return(item);
								brake;
							}
						};
					break;
					case ".":
						//console.log("selector de class");
						let clase=selector.slice(1,selector.length);
						//console.log(clase);
						for(let i=0;i<array.length;i++){
							let item=array[i];
							if(hasClass(item,clase)){
								return(item);
								brake;
							}
						};
					break;
					default:
						console.log("selector no definido");
					break;
				}
			}
			function onMouseEnd(event){
				//console.log("solto");
				if(elementPress!==undefined && elementPress!==""){
					if(detectarBase){
						let target=elementPress;
						if(target.hasAttribute("base")){
							let base=target.getAttribute("base");
							let elementbase=document.querySelector("#"+base);
							let targetlef=target.offsetLeft;
							let targettop=target.offsetTop;
							let elementbaseleft=elementbase.offsetLeft;
							let elementbasetop=elementbase.offsetTop;
							if(Math.abs(targettop-elementbasetop)<=distancia && Math.abs(targetlef-elementbaseleft)<=distancia){
								//console.log("detectado");
								if(typeof(funcion1)==="function"){
									funcion1(elementPress);
								}
							}else{
								//console.log("no esta");
								if(volverPuntoInicio){
									volverAlInicio();
								}
								if(typeof(funcion2)==="function"){
									funcion2(elementPress);
								}
							}
							elementPress="";
						}else{
							console.log("El elemento no tiene base");
							if(volverPuntoInicio){
								volverAlInicio();
							}
							if(typeof(funcion2)==="function"){
								funcion2(elementPress);
							}
							elementPress="";
						}
					}else{
						if(volverPuntoInicio){
							volverAlInicio();
						}
						if(typeof(funcion1)==="function"){
							funcion1(elementPress);
						}
					}
				}else{
					console.log("no presiono ningun elemento");
				}
			}
			function volverAlInicio(){
				let pix=Number(elementPress.getAttribute("initposx"));
				let piy=Number(elementPress.getAttribute("initposy"));
				setTimeout(function(){
					elementPress.style.left=pix+"px";
					elementPress.style.top=piy+"px";
				},1000); 
			}
			function hasClass(el, cn){
			    var classes = el.classList;
			    for(var j = 0; j < classes.length; j++){
			        if(classes[j] == cn){
			            return true;
			        }
			    }
			}
			/*
			function determinarsiespc() {
				//retorna true si es pc false si es movil
				let navegador = navigator.userAgent;
				if (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/webOS/i) || navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/Windows Phone/i)) {
					return (false);
				} else {
					return (true);
				}
			}
			*/
		}
		function saludar(element){
			element.style.display="none";
		}
		function despedir(element){
			//console.log(element);
			//console.log("chao");
		}
		drag('.drag',true,saludar,despedir,10,false);
	</script>
</body>
</html>
